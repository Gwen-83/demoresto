<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Gestion du site - Chez Mario</title>
  <link rel="stylesheet" href="style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    .admin-tabs {
      display: flex;
      background-color: #f8f9fa;
      border-bottom: 1px solid #ddd;
      margin: 20px 0;
    }
    
    .tab-button {
      background: none;
      border: none;
      padding: 15px 25px;
      cursor: pointer;
      font-size: 16px;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
    }
    
    .tab-button.active {
      background-color: #fff;
      border-bottom-color: #007bff;
      color: #007bff;
      font-weight: bold;
    }
    
    .tab-content {
      display: none;
      padding: 20px 0;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .reservations-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .calendar-view {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      margin: 20px 0;
    }
    
    .calendar-header {
      background-color: #007bff;
      color: white;
      padding: 10px;
      text-align: center;
      font-weight: bold;
    }
    
    .calendar-day {
      border: 1px solid #ddd;
      min-height: 120px;
      padding: 5px;
      background-color: #fff;
      position: relative;
    }
    
    .calendar-day.other-month {
      background-color: #f8f9fa;
      color: #999;
    }
    
    .calendar-day-number {
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .reservations-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    .main-content {
      display: flex;
      min-height: 600px;
    }

    .calendar-section {
      flex: 2;
      padding: 30px;
      border-right: 1px solid #e0e0e0;
    }

    .reservations-section {
      flex: 1;
      padding: 30px;
      background: #f8f9fa;
    }

    .calendar {
      background: white;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #f0f0f0;
    }

    .calendar-nav {
      background: #667eea;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s ease;
    }

    .calendar-nav:hover {
      background: #5a6fd8;
      transform: translateY(-2px);
    }

    .calendar-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: #333;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 1px;
      background: #e0e0e0;
      border-radius: 8px;
      overflow: hidden;
    }

    .calendar-day-header {
      background: #667eea;
      color: white;
      padding: 12px;
      text-align: center;
      font-weight: 600;
      font-size: 0.9rem;
    }

    .calendar-day {
      background: white;
      min-height: 80px;
      padding: 8px;
      position: relative;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .calendar-day:hover {
      background: #f5f5f5;
    }

    .calendar-day.other-month {
      background: #f9f9f9;
      color: #ccc;
    }

    .calendar-day.today {
      background: #fff3cd;
      border: 2px solid #ffc107;
    }

    .day-number {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .reservation-dot {
      position: absolute;
      bottom: 4px;
      right: 4px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      font-size: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
    }

    .reservation-dot.pending {
      background: #ffc107;
    }

    .reservation-dot.validee {
      background: #28a745;
    }

    .reservation-dot.refusee {
      background: #dc3545;
    }

    .reservations-list {
      max-height: 500px;
      overflow-y: auto;
    }

    .section-title {
      font-size: 1.3rem;
      margin-bottom: 20px;
      color: #333;
      border-bottom: 2px solid #667eea;
      padding-bottom: 10px;
    }

    .reservation-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      border-left: 4px solid #667eea;
      transition: all 0.3s ease;
    }

    .reservation-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    }

    .reservation-card.pending {
      border-left-color: #ffc107;
    }

    .reservation-card.validee {
      border-left-color: #28a745;
    }

    .reservation-card.refusee {
      border-left-color: #dc3545;
    }

    .reservation-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .reservation-id {
      font-weight: bold;
      color: #667eea;
      font-size: 1.1rem;
    }

    .status-badge.pending {
      background: #fff3cd;
      color: #856404;
    }

    .status-badge.validee {
      background: #d4edda;
      color: #155724;
    }

    .status-badge.refusee {
      background: #f8d7da;
      color: #721c24;
    }

    .reservation-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 15px;
      font-size: 0.9rem;
    }

    .detail-item {
      display: flex;
      align-items: center;
    }

    .detail-label {
      font-weight: 600;
      margin-right: 8px;
      color: #555;
    }

    .detail-value {
      color: #333;
    }

    .reservation-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      transition: all 0.3s ease;
      text-transform: uppercase;
    }

    .btn:hover {
      transform: translateY(-1px);
    }

    .btn-accept {
      background: #28a745;
      color: white;
    }

    .btn-accept:hover {
      background: #218838;
    }

    .btn-reject {
      background: #dc3545;
      color: white;
    }

    .btn-reject:hover {
      background: #c82333;
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .main-content {
        flex-direction: column;
      }
      
      .calendar-section {
        border-right: none;
        border-bottom: 1px solid #e0e0e0;
      }
      
      .reservation-details {
        grid-template-columns: 1fr;
      }
    }
    
    .detail-item {
      margin: 10px 0;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }
    
    .detail-label {
      font-weight: bold;
      color: #555;
    }
    
    .status-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
      text-transform: uppercase;
    }
    
    .status-en_attente {
      background-color: #fff3cd;
      color: #856404;
    }
    
    .status-validee {
      background-color: #d4edda;
      color: #155724;
    }
    
    .status-refusee {
      background-color: #f8d7da;
      color: #721c24;
    }
    
    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .btn-validate {
      background-color: #28a745;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    
    .btn-reject {
      background-color: #dc3545;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    
    .btn-close {
      background-color: #6c757d;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin-left: auto;
    }
    
    .btn-validate:hover {
      background-color: #218838;
    }
    
    .btn-reject:hover {
      background-color: #c82333;
    }
    
    .btn-close:hover {
      background-color: #5a6268;
    }
    
    .month-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 20px 0;
      padding: 10px 20px;
      background-color: #f8f9fa;
      border-radius: 5px;
    }
    
    .nav-button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    
    .nav-button:hover {
      background-color: #0056b3;
    }
    
    .current-month {
      font-size: 18px;
      font-weight: bold;
      color: #333;
    }
    
    .reject-reason {
      width: 100%;
      min-height: 80px;
      margin: 10px 0;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      resize: vertical;
    }
    
    .stats-overview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    
    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .stat-number {
      font-size: 2em;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .stat-label {
      font-size: 0.9em;
      opacity: 0.9;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
    }

    .modal-content {
      background: white;
      margin: 5% auto;
      padding: 30px;
      border-radius: 15px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #f0f0f0;
    }

    .modal-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: #333;
    }

    .close {
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      color: #aaa;
      transition: color 0.3s ease;
    }

    .close:hover {
      color: #333;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
    }

    .form-control {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }

    .form-control:focus {
      outline: none;
      border-color: #667eea;
    }

    .modal-actions {
      display: flex;
      gap: 15px;
      justify-content: flex-end;
    }

    .btn-modal {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .btn-cancel {
      background: #6c757d;
      color: white;
    }

    .btn-cancel:hover {
      background: #5a6268;
    }

    .btn-confirm {
      background: #dc3545;
      color: white;
    }

    .btn-confirm:hover {
      background: #c82333;
    }
  </style>
</head>
<body>
<div id="notification" class="notification hidden">
  <p id="notification-message"></p>
  <button class="close-btn" onclick="hideNotification()">×</button>
</div>

<div class="modal-overlay" id="modalOverlay" onclick="closeReservationDetails()"></div>

<header>
  <h1>Chez Mario</h1>
  <button class="menu-toggle" aria-label="Ouvrir le menu">&#9776;</button>
  <nav>
    <div class="nav-left">
      <a href="index.html">Accueil</a>
      <a href="menu.html">Menu</a>
      <a href="reservation.html">Réservation</a>
      <a href="contact.html">Contact</a>
      <a href="panier.html">Voir le panier</a>
      <a href="admin.html" id="admin-link" style="display: none;">Administration</a>
      <button id="auth-button"></button>
    </div>
    <div id="user-status"></div>
    <div id="role"></div>
  </nav>
</header>

<div class="admin-tabs">
  <button class="tab-button active" onclick="switchTab('reservations')">Réservations</button>
  <button class="tab-button" onclick="switchTab('products')">Produits</button>
  <button class="tab-button" onclick="switchTab('schedules')">Horaires</button>
</div>

<!-- Onglet Réservations -->
<div id="reservations-tab" class="tab-content active">
  <div class="reservations-container">
    <h2>Gestion des réservations</h2>
    
    <div class="stats-overview">
      <div class="stat-card">
        <div class="stat-number" id="stat-total">0</div>
        <div class="stat-label">Total réservations</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="stat-pending">0</div>
        <div class="stat-label">En attente</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="stat-validated">0</div>
        <div class="stat-label">Validées</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="stat-rejected">0</div>
        <div class="stat-label">Refusées</div>
      </div>
    </div>
    
    <div class="main-content">
      <div class="calendar-section">
        <div class="calendar">
          <div class="calendar-header">
            <button class="calendar-nav" onclick="previousMonth()">‹</button>
            <div class="calendar-title" id="calendar-title"></div>
            <button class="calendar-nav" onclick="nextMonth()">›</button>
          </div>
          <div class="calendar-grid" id="calendar-grid">
            <!-- Calendrier généré dynamiquement -->
          </div>
        </div>
      </div>
      
      <div class="reservations-section">
        <h2 class="section-title">Réservations du jour</h2>
        <div class="reservations-list" id="reservations-list">
          <!-- Réservations générées dynamiquement -->
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Onglet Produits (contenu existant) -->
<div id="products-tab" class="tab-content">
  <section class="presentation">
    <div class="presentation-container" style="flex-direction: column; align-items: center;">
      <div class="presentation-texte" style="text-align: center;">
        <h2>Gestion des produits</h2>
        <p>Ajoutez, modifiez ou supprimez les produits du menu.</p>
      </div>

      <div class="produit-table-container" style="overflow-x: auto; margin-top: 40px; width: 100%;">
        <table id="productTable" class="styled-table">
        </table>
      </div>
    </div>
  </section>

  <section class="presentation" style="background-color: #fafafa;">
    <div class="presentation-container" style="flex-direction: column; align-items: center;">
      <div class="presentation-texte" style="max-width: 600px; text-align: center;">
        <h2 id="form-title">Ajouter un produit</h2>
        <form onsubmit="addProduct(); return false;" class="form-produit">
          <input id="name" placeholder="Nom" required>
          <input id="description" placeholder="Description">
          <input id="price" type="number" placeholder="Prix" required>
          <input id="image" placeholder="URL de l'image">
          <input id="category" placeholder="Catégorie">
        
          <select id="allergens" multiple style="height: 120px;">
            <option value="Gluten">Gluten</option>
            <option value="Lactose">Lactose</option>
            <option value="Oeuf">Oeuf</option>
            <option value="Fruits à coques">Fruits à coques</option>
            <option value="Arachides">Arachides</option>
            <option value="Soja">Soja</option>
            <option value="Poissons">Poissons</option>
            <option value="Crustacés">Crustacés</option>
            <option value="Mollusques">Mollusques</option>
            <option value="Sésame">Sésame</option>
            <option>Aucune Allergie</option>
          </select>

          <button type="submit" class="map-button" id="form-button">Ajouter</button>
          <button type="button" id="cancel-button" class="map-button" style="background-color: #666; margin-top: 10px; display: none;" onclick="cancelEdit()">Annuler</button>
        </form>
      </div>
    </div>
  </section>
</div>

<!-- Onglet Horaires (contenu existant) -->
<div id="schedules-tab" class="tab-content">
  <div class="schedule-admin">
    <h2>Modifier les horaires d'ouverture</h2>
    <form id="schedule-form">
      <div id="schedule-fields"></div>
      <button type="submit">Enregistrer les horaires</button>
    </form>
  </div>
</div>

<!-- Modal pour les détails de réservation -->
<!-- Modal de refus -->
<div id="rejectModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title">Refuser la réservation</h3>
      <span class="close" onclick="closeRejectModal()">&times;</span>
    </div>
    <div class="form-group">
      <label class="form-label">Motif du refus (optionnel) :</label>
      <textarea class="form-control" id="rejectReason" rows="4" placeholder="Expliquez la raison du refus..."></textarea>
    </div>
    <div class="modal-actions">
      <button class="btn-modal btn-cancel" onclick="closeRejectModal()">Annuler</button>
      <button class="btn-modal btn-confirm" onclick="confirmReject()">Confirmer le refus</button>
    </div>
  </div>
</div>

<footer>
  <div class="footer-logo">
    <img src="public/logo.png" alt="Logo Chez Mario">
  </div>
  <div class="footer-infos">
    <p>Chez Mario <span class="sep">|</span> 12 Rue des Oliviers, 66000 Perpignan <span class="sep">|</span> 04 68 12 34 56 <span class="sep">|</span> email: contact@chezmario.fr</p>
  </div>
  <div class="footer-credit">
    <p>Réalisation : GD</p>
  </div>
  <div class="footer-map">
    <a href="https://www.google.com/maps/place/12+Rue+des+Oliviers,+66000+Perpignan" target="_blank" class="map-button">Plan d'accès</a>
  </div>
</footer>

<script src="script.js" defer></script>
<script>
// Variables globales pour la gestion des réservations
// Variables globales pour la gestion des réservations
let currentDate = new Date();
let selectedDate = new Date();
let reservations = [];
let currentReservationId = null;

// Fonction pour basculer entre les onglets (garder existant)
function switchTab(tabName) {
  // Masquer tous les onglets
  document.querySelectorAll('.tab-content').forEach(tab => {
    tab.classList.remove('active');
  });
  
  // Désactiver tous les boutons d'onglet
  document.querySelectorAll('.tab-button').forEach(button => {
    button.classList.remove('active');
  });
  
  // Activer l'onglet sélectionné
  document.getElementById(tabName + '-tab').classList.add('active');
  event.target.classList.add('active');
  
  // Charger les données spécifiques à l'onglet
  if (tabName === 'reservations') {
    loadReservations();
  }
}

// Charger les réservations depuis l'API
async function loadReservations() {
  try {
    const token = localStorage.getItem('token');
    if (!token) {
      showNotification('Vous devez être connecté pour accéder à cette page', 'error');
      return;
    }

    const response = await fetch('/api/reservations', {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });

    if (response.ok) {
      reservations = await response.json();
      updateStats();
      renderCalendar();
      renderSelectedDateReservations();
    } else {
      const error = await response.json();
      showNotification(error.error || 'Erreur lors du chargement des réservations', 'error');
    }
  } catch (error) {
    console.error('Erreur:', error);
    showNotification('Erreur de connexion', 'error');
  }
}

// Mettre à jour les statistiques
function updateStats() {
  const total = reservations.length;
  const pending = reservations.filter(r => r.status === 'pending' || r.status === 'en_attente').length;
  const validated = reservations.filter(r => r.status === 'validee').length;
  const rejected = reservations.filter(r => r.status === 'refusee').length;
  
  document.getElementById('stat-total').textContent = total;
  document.getElementById('stat-pending').textContent = pending;
  document.getElementById('stat-validated').textContent = validated;
  document.getElementById('stat-rejected').textContent = rejected;
}

// Rendu du calendrier
function renderCalendar() {
  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();
  
  document.getElementById('calendar-title').textContent = 
    new Date(year, month).toLocaleDateString('fr-FR', { 
      month: 'long', 
      year: 'numeric' 
    });

  const firstDay = new Date(year, month, 1);
  const startDate = new Date(firstDay);
  startDate.setDate(startDate.getDate() - firstDay.getDay());

  const calendarGrid = document.getElementById('calendar-grid');
  calendarGrid.innerHTML = '';

  // En-têtes des jours
  const dayHeaders = ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'];
  dayHeaders.forEach(day => {
    const dayHeader = document.createElement('div');
    dayHeader.className = 'calendar-day-header';
    dayHeader.textContent = day;
    calendarGrid.appendChild(dayHeader);
  });

  // Jours du calendrier
  const currentDateObj = new Date();
  const currentDateStr = currentDateObj.toISOString().split('T')[0];

  for (let i = 0; i < 42; i++) {
    const date = new Date(startDate);
    date.setDate(startDate.getDate() + i);
    
    const dayElement = document.createElement('div');
    dayElement.className = 'calendar-day';
    
    if (date.getMonth() !== month) {
      dayElement.classList.add('other-month');
    }
    
    const dateStr = date.toISOString().split('T')[0];
    if (dateStr === currentDateStr) {
      dayElement.classList.add('today');
    }

    dayElement.innerHTML = `<div class="day-number">${date.getDate()}</div>`;
    
    // Ajouter les points de réservation
    const dayReservations = reservations.filter(r => r.date === dateStr);
    if (dayReservations.length > 0) {
      const dot = document.createElement('div');
      dot.className = 'reservation-dot';
      
      // Déterminer la couleur selon le statut prioritaire
      const pendingCount = dayReservations.filter(r => r.status === 'pending' || r.status === 'en_attente').length;
      const valideeCount = dayReservations.filter(r => r.status === 'validee').length;
      const refuseeCount = dayReservations.filter(r => r.status === 'refusee').length;
      
      if (pendingCount > 0) {
        dot.classList.add('pending');
      } else if (valideeCount > 0) {
        dot.classList.add('validee');
      } else {
        dot.classList.add('refusee');
      }
      
      dot.textContent = dayReservations.length;
      dayElement.appendChild(dot);
    }

    dayElement.addEventListener('click', () => selectDate(date));
    calendarGrid.appendChild(dayElement);
  }
}

// Sélectionner une date
function selectDate(date) {
  selectedDate = new Date(date);
  renderSelectedDateReservations();
}

// Rendu des réservations du jour sélectionné
function renderSelectedDateReservations() {
  const dateStr = selectedDate.toISOString().split('T')[0];
  const dayReservations = reservations.filter(r => r.date === dateStr);
  
  const reservationsList = document.getElementById('reservations-list');
  const sectionTitle = document.querySelector('.section-title');
  
  sectionTitle.textContent = `Réservations du ${selectedDate.toLocaleDateString('fr-FR')} (${dayReservations.length})`;
  
  if (dayReservations.length === 0) {
    reservationsList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">Aucune réservation pour cette date</p>';
    return;
  }

  reservationsList.innerHTML = dayReservations.map(reservation => {
    const status = reservation.status === 'en_attente' ? 'pending' : reservation.status;
    const statusLabel = status === 'pending' ? 'En attente' : 
                       status === 'validee' ? 'Validée' : 'Refusée';
    
    return `
      <div class="reservation-card ${status}">
        <div class="reservation-header">
          <div class="reservation-id">#${reservation.id}</div>
          <div class="status-badge ${status}">
            ${statusLabel}
          </div>
        </div>
        <div class="reservation-details">
          <div class="detail-item">
            <span class="detail-label">📧</span>
            <span class="detail-value">${reservation.email}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">📞</span>
            <span class="detail-value">${reservation.telephone}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">👥</span>
            <span class="detail-value">${reservation.couverts} couverts</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">🕒</span>
            <span class="detail-value">${reservation.heure}</span>
          </div>
        </div>
        ${reservation.commentaire ? `
          <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 6px; font-style: italic;">
            💬 ${reservation.commentaire}
          </div>
        ` : ''}
        ${status === 'pending' ? `
          <div class="reservation-actions">
            <button class="btn btn-accept" onclick="acceptReservation(${reservation.id})">
              ✓ Accepter
            </button>
            <button class="btn btn-reject" onclick="openRejectModal(${reservation.id})">
              ✗ Refuser
            </button>
          </div>
        ` : ''}
      </div>
    `;
  }).join('');
}

// Navigation du calendrier
function previousMonth() {
  currentDate.setMonth(currentDate.getMonth() - 1);
  renderCalendar();
}

function nextMonth() {
  currentDate.setMonth(currentDate.getMonth() + 1);
  renderCalendar();
}

// Accepter une réservation
async function acceptReservation(reservationId) {
  try {
    const token = localStorage.getItem('token');
    const response = await fetch(`/api/reservation/${reservationId}/validate`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      }
    });

    if (response.ok) {
      showNotification('Réservation acceptée avec succès', 'success');
      await loadReservations();
    } else {
      const error = await response.json();
      showNotification(error.error || 'Erreur lors de l\'acceptation', 'error');
    }
  } catch (error) {
    console.error('Erreur:', error);
    showNotification('Erreur de connexion', 'error');
  }
}

// Ouvrir le modal de refus
function openRejectModal(reservationId) {
  currentReservationId = reservationId;
  document.getElementById('rejectModal').style.display = 'block';
  document.getElementById('rejectReason').value = '';
}

// Fermer le modal de refus
function closeRejectModal() {
  document.getElementById('rejectModal').style.display = 'none';
  currentReservationId = null;
}

// Confirmer le refus
async function confirmReject() {
  if (!currentReservationId) return;

  try {
    const token = localStorage.getItem('token');
    const reason = document.getElementById('rejectReason').value;
    
    const response = await fetch(`/api/reservation/${currentReservationId}/reject`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ reason })
    });

    if (response.ok) {
      showNotification('Réservation refusée', 'success');
      await loadReservations();
      closeRejectModal();
    } else {
      const error = await response.json();
      showNotification(error.error || 'Erreur lors du refus', 'error');
    }
  } catch (error) {
    console.error('Erreur:', error);
    showNotification('Erreur de connexion', 'error');
  }
}

// Fermer le modal en cliquant à l'extérieur
window.onclick = function(event) {
  const modal = document.getElementById('rejectModal');
  if (event.target === modal) {
    closeRejectModal();
  }
}

// Charger les réservations au chargement de la page
document.addEventListener('DOMContentLoaded', () => {
  if (document.getElementById('reservations-tab').classList.contains('active')) {
    loadReservations();
  }
});
</script>
</body>
</html>